<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.netdisk.mappers.FileInfoMapper">
    <update id="updateFileInfo">
        UPDATE file_info
        <set>
            <if test="fileMd5 != null">file_md5 = #{fileMd5},</if>
            <if test="filePid != null">file_pid = #{filePid},</if>
            <if test="fileSize != null">file_size = #{fileSize},</if>
            <if test="fileName != null">file_name = #{fileName},</if>
            <if test="fileCover != null">file_cover = #{fileCover},</if>
            <if test="filePath != null">file_path = #{filePath},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="lastUpdateTime != null">last_update_time = #{lastUpdateTime},</if>
            <if test="folderType != null">floder_type = #{folderType},</if>
            <if test="fileCategory != null">file_category = #{fileCategory},</if>
            <if test="fileType != null">file_type = #{fileType},</if>
            <if test="status != null">status = #{status},</if>
            <if test="recoveryTime != null">recovery_time = #{recoveryTime},</if>
            <if test="delFlag != null">del_flag = #{delFlag}</if>
        </set>
        WHERE user_id = #{userId} and file_id = #{fileId};
    </update>

    <select id="selectByUserIdAndCategory" resultType="com.netdisk.vo.FileInfoVo">
        select
        file_id, file_pid, file_size, file_name, file_cover, create_time, last_update_time,
        floder_type, file_category, file_type, status
        from file_info
        where user_id = #{userId}
        and del_flag = 2
        <if test="category != null"> and file_category = #{category}</if>
        order by last_update_time desc
    </select>

    <select id="selectUseSpace" resultType="java.lang.Long">
        select ifnull(sum(file_size),0) from file_info
        where user_id = #{userId}
    </select>

    <select id="selectOneByMD5" resultType="com.netdisk.pojo.FileInfo">
        select * from file_info
        where file_md5 = #{fileMd5} and status=2 limit 1
    </select>

    <select id="selectOneByUserIdAndfilePidAndfileName" resultType="com.netdisk.pojo.FileInfo">
        select * from file_info
        where user_id = #{userId} and file_pid = #{filePid} and file_name = #{fileName}
    </select>
</mapper>